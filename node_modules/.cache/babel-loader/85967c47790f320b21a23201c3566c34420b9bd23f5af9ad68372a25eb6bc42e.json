{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getPatientInfo, getAssessmentInfo, saveAssessment, updateAssessment } from '@/api/assessment';\nexport default {\n  name: 'HealthAssessment',\n  data() {\n    return {\n      isViewMode: false,\n      patientInfo: {\n        name: '',\n        gender: '',\n        age: '',\n        admissionId: '',\n        bedNumber: '',\n        nursingLevel: ''\n      },\n      form: {\n        medicalHistory: [],\n        otherMedicalHistory: '',\n        forbiddenDrugs: '',\n        dietaryRestrictions: [],\n        otherDietaryRestrictions: '',\n        conclusion: '',\n        admissionOpinion: ''\n      },\n      rules: {\n        conclusion: [{\n          required: true,\n          message: '请输入体检结论',\n          trigger: 'blur'\n        }],\n        admissionOpinion: [{\n          required: true,\n          message: '请选择入院意见',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  created() {\n    const patientId = this.$route.params.id;\n    if (!patientId) {\n      this.$message.error('患者ID不能为空');\n      this.$router.push('/assessment');\n      return;\n    }\n    // 判断是否为查看模式\n    this.isViewMode = this.$route.query.mode === 'view';\n    this.fetchPatientInfo(patientId);\n    this.fetchAssessmentInfo(patientId);\n  },\n  methods: {\n    async fetchPatientInfo(patientId) {\n      try {\n        const {\n          data\n        } = await getPatientInfo(patientId);\n        this.patientInfo = data;\n      } catch (error) {\n        this.$message.error('获取患者信息失败');\n      }\n    },\n    async fetchAssessmentInfo(patientId) {\n      try {\n        const {\n          data\n        } = await getAssessmentInfo(patientId);\n        if (data) {\n          this.form = data;\n        }\n      } catch (error) {\n        this.$message.error('获取评估信息失败');\n      }\n    },\n    submitForm(formName) {\n      this.$refs[formName].validate(async valid => {\n        if (valid) {\n          try {\n            const patientId = this.$route.params.id;\n            const data = {\n              ...this.form,\n              patientId\n            };\n            if (this.form.id) {\n              await updateAssessment(this.form.id, data);\n            } else {\n              await saveAssessment(data);\n            }\n            this.$message.success('保存成功');\n            this.$router.push('/assessment');\n          } catch (error) {\n            this.$message.error(error.message || '保存失败');\n          }\n        } else {\n          this.$message.warning('请完善必填信息');\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    goBack() {\n      this.$router.push('/assessment');\n    }\n  }\n};","map":{"version":3,"names":["getPatientInfo","getAssessmentInfo","saveAssessment","updateAssessment","name","data","isViewMode","patientInfo","gender","age","admissionId","bedNumber","nursingLevel","form","medicalHistory","otherMedicalHistory","forbiddenDrugs","dietaryRestrictions","otherDietaryRestrictions","conclusion","admissionOpinion","rules","required","message","trigger","created","patientId","$route","params","id","$message","error","$router","push","query","mode","fetchPatientInfo","fetchAssessmentInfo","methods","submitForm","formName","$refs","validate","valid","success","warning","resetForm","resetFields","goBack"],"sources":["src/views/HealthAssessment.vue"],"sourcesContent":["<template>\n  <div class=\"health-assessment\">\n    <el-card class=\"box-card\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span>患者健康评估</span>\n        <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"goBack\">返回</el-button>\n      </div>\n      \n      <!-- 患者基本信息 -->\n      <el-descriptions title=\"患者信息\" :column=\"3\" border>\n        <el-descriptions-item label=\"姓名\">{{ patientInfo.name }}</el-descriptions-item>\n        <el-descriptions-item label=\"性别\">{{ patientInfo.gender }}</el-descriptions-item>\n        <el-descriptions-item label=\"年龄\">{{ patientInfo.age }}岁</el-descriptions-item>\n        <el-descriptions-item label=\"入院编号\">{{ patientInfo.admissionId }}</el-descriptions-item>\n        <el-descriptions-item label=\"床位号\">{{ patientInfo.bedNumber }}</el-descriptions-item>\n        <el-descriptions-item label=\"护理等级\">{{ patientInfo.nursingLevel }}</el-descriptions-item>\n      </el-descriptions>\n\n      <!-- 健康评估表单 -->\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"120px\" class=\"assessment-form\" :disabled=\"isViewMode\">\n        <el-form-item label=\"现病史\" prop=\"medicalHistory\">\n          <el-checkbox-group v-model=\"form.medicalHistory\">\n            <el-checkbox label=\"高血压\">高血压</el-checkbox>\n            <el-checkbox label=\"糖尿病\">糖尿病</el-checkbox>\n            <el-checkbox label=\"心脏病\">心脏病</el-checkbox>\n            <el-checkbox label=\"其他\">其他</el-checkbox>\n          </el-checkbox-group>\n          <el-input\n            v-if=\"form.medicalHistory.includes('其他')\"\n            v-model=\"form.otherMedicalHistory\"\n            type=\"textarea\"\n            placeholder=\"请输入其他病史\"\n          ></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"禁忌药品\" prop=\"forbiddenDrugs\">\n          <el-input\n            type=\"textarea\"\n            v-model=\"form.forbiddenDrugs\"\n            placeholder=\"请输入禁忌药品\"\n          ></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"饮食禁忌\" prop=\"dietaryRestrictions\">\n          <el-checkbox-group v-model=\"form.dietaryRestrictions\">\n            <el-checkbox label=\"海鲜\">海鲜</el-checkbox>\n            <el-checkbox label=\"辛辣\">辛辣</el-checkbox>\n            <el-checkbox label=\"油腻\">油腻</el-checkbox>\n            <el-checkbox label=\"其他\">其他</el-checkbox>\n          </el-checkbox-group>\n          <el-input\n            v-if=\"form.dietaryRestrictions.includes('其他')\"\n            v-model=\"form.otherDietaryRestrictions\"\n            type=\"textarea\"\n            placeholder=\"请输入其他饮食禁忌\"\n          ></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"体检结论\" prop=\"conclusion\">\n          <el-input\n            type=\"textarea\"\n            v-model=\"form.conclusion\"\n            :rows=\"4\"\n            placeholder=\"请输入体检结论\"\n          ></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"入院意见\" prop=\"admissionOpinion\">\n          <el-radio-group v-model=\"form.admissionOpinion\">\n            <el-radio label=\"agree\">同意入院</el-radio>\n            <el-radio label=\"disagree\">不同意入院</el-radio>\n          </el-radio-group>\n        </el-form-item>\n\n        <el-form-item v-if=\"!isViewMode\">\n          <el-button type=\"primary\" @click=\"submitForm('form')\">保存评估</el-button>\n          <el-button @click=\"resetForm('form')\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { getPatientInfo, getAssessmentInfo, saveAssessment, updateAssessment } from '@/api/assessment'\n\nexport default {\n  name: 'HealthAssessment',\n  data() {\n    return {\n      isViewMode: false,\n      patientInfo: {\n        name: '',\n        gender: '',\n        age: '',\n        admissionId: '',\n        bedNumber: '',\n        nursingLevel: ''\n      },\n      form: {\n        medicalHistory: [],\n        otherMedicalHistory: '',\n        forbiddenDrugs: '',\n        dietaryRestrictions: [],\n        otherDietaryRestrictions: '',\n        conclusion: '',\n        admissionOpinion: ''\n      },\n      rules: {\n        conclusion: [\n          { required: true, message: '请输入体检结论', trigger: 'blur' }\n        ],\n        admissionOpinion: [\n          { required: true, message: '请选择入院意见', trigger: 'change' }\n        ]\n      }\n    }\n  },\n  created() {\n    const patientId = this.$route.params.id\n    if (!patientId) {\n      this.$message.error('患者ID不能为空')\n      this.$router.push('/assessment')\n      return\n    }\n    // 判断是否为查看模式\n    this.isViewMode = this.$route.query.mode === 'view'\n    this.fetchPatientInfo(patientId)\n    this.fetchAssessmentInfo(patientId)\n  },\n  methods: {\n    async fetchPatientInfo(patientId) {\n      try {\n        const { data } = await getPatientInfo(patientId)\n        this.patientInfo = data\n      } catch (error) {\n        this.$message.error('获取患者信息失败')\n      }\n    },\n    async fetchAssessmentInfo(patientId) {\n      try {\n        const { data } = await getAssessmentInfo(patientId)\n        if (data) {\n          this.form = data\n        }\n      } catch (error) {\n        this.$message.error('获取评估信息失败')\n      }\n    },\n    submitForm(formName) {\n      this.$refs[formName].validate(async (valid) => {\n        if (valid) {\n          try {\n            const patientId = this.$route.params.id\n            const data = {\n              ...this.form,\n              patientId\n            }\n            if (this.form.id) {\n              await updateAssessment(this.form.id, data)\n            } else {\n              await saveAssessment(data)\n            }\n            this.$message.success('保存成功')\n            this.$router.push('/assessment')\n          } catch (error) {\n            this.$message.error(error.message || '保存失败')\n          }\n        } else {\n          this.$message.warning('请完善必填信息')\n          return false\n        }\n      })\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    goBack() {\n      this.$router.push('/assessment')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.health-assessment {\n  padding: 20px;\n}\n.assessment-form {\n  margin-top: 20px;\n}\n.el-descriptions {\n  margin-bottom: 20px;\n}\n</style> "],"mappings":";AAoFA,SAAAA,cAAA,EAAAC,iBAAA,EAAAC,cAAA,EAAAC,gBAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,UAAA;MACAC,WAAA;QACAH,IAAA;QACAI,MAAA;QACAC,GAAA;QACAC,WAAA;QACAC,SAAA;QACAC,YAAA;MACA;MACAC,IAAA;QACAC,cAAA;QACAC,mBAAA;QACAC,cAAA;QACAC,mBAAA;QACAC,wBAAA;QACAC,UAAA;QACAC,gBAAA;MACA;MACAC,KAAA;QACAF,UAAA,GACA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,EACA;QACAJ,gBAAA,GACA;UAAAE,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MAEA;IACA;EACA;EACAC,QAAA;IACA,MAAAC,SAAA,QAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;IACA,KAAAH,SAAA;MACA,KAAAI,QAAA,CAAAC,KAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;MACA;IACA;IACA;IACA,KAAA3B,UAAA,QAAAqB,MAAA,CAAAO,KAAA,CAAAC,IAAA;IACA,KAAAC,gBAAA,CAAAV,SAAA;IACA,KAAAW,mBAAA,CAAAX,SAAA;EACA;EACAY,OAAA;IACA,MAAAF,iBAAAV,SAAA;MACA;QACA;UAAArB;QAAA,UAAAL,cAAA,CAAA0B,SAAA;QACA,KAAAnB,WAAA,GAAAF,IAAA;MACA,SAAA0B,KAAA;QACA,KAAAD,QAAA,CAAAC,KAAA;MACA;IACA;IACA,MAAAM,oBAAAX,SAAA;MACA;QACA;UAAArB;QAAA,UAAAJ,iBAAA,CAAAyB,SAAA;QACA,IAAArB,IAAA;UACA,KAAAQ,IAAA,GAAAR,IAAA;QACA;MACA,SAAA0B,KAAA;QACA,KAAAD,QAAA,CAAAC,KAAA;MACA;IACA;IACAQ,WAAAC,QAAA;MACA,KAAAC,KAAA,CAAAD,QAAA,EAAAE,QAAA,OAAAC,KAAA;QACA,IAAAA,KAAA;UACA;YACA,MAAAjB,SAAA,QAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;YACA,MAAAxB,IAAA;cACA,QAAAQ,IAAA;cACAa;YACA;YACA,SAAAb,IAAA,CAAAgB,EAAA;cACA,MAAA1B,gBAAA,MAAAU,IAAA,CAAAgB,EAAA,EAAAxB,IAAA;YACA;cACA,MAAAH,cAAA,CAAAG,IAAA;YACA;YACA,KAAAyB,QAAA,CAAAc,OAAA;YACA,KAAAZ,OAAA,CAAAC,IAAA;UACA,SAAAF,KAAA;YACA,KAAAD,QAAA,CAAAC,KAAA,CAAAA,KAAA,CAAAR,OAAA;UACA;QACA;UACA,KAAAO,QAAA,CAAAe,OAAA;UACA;QACA;MACA;IACA;IACAC,UAAAN,QAAA;MACA,KAAAC,KAAA,CAAAD,QAAA,EAAAO,WAAA;IACA;IACAC,OAAA;MACA,KAAAhB,OAAA,CAAAC,IAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}