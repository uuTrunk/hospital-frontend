{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: 'HealthAssessment',\n  props: {\n    id: {\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {\n      currentStep: 0,\n      patientInfo: {},\n      basicInfo: {\n        name: '',\n        gender: '',\n        age: '',\n        idCard: '',\n        phone: '',\n        emergencyContact: '',\n        emergencyPhone: ''\n      },\n      healthInfo: {\n        medicalHistory: [],\n        hasAllergies: false,\n        allergiesDetail: '',\n        selfCare: '',\n        remarks: ''\n      },\n      assessmentResult: {\n        conclusion: '',\n        suggestions: '',\n        doctor: ''\n      },\n      // 表单验证规则\n      basicRules: {\n        idCard: [{\n          required: true,\n          message: '请输入身份证号',\n          trigger: 'blur'\n        }, {\n          pattern: /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/,\n          message: '请输入正确的身份证号',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          message: '请输入联系电话',\n          trigger: 'blur'\n        }, {\n          pattern: /^1[3-9]\\d{9}$/,\n          message: '请输入正确的手机号码',\n          trigger: 'blur'\n        }],\n        emergencyContact: [{\n          required: true,\n          message: '请输入紧急联系人',\n          trigger: 'blur'\n        }],\n        emergencyPhone: [{\n          required: true,\n          message: '请输入紧急联系电话',\n          trigger: 'blur'\n        }, {\n          pattern: /^1[3-9]\\d{9}$/,\n          message: '请输入正确的手机号码',\n          trigger: 'blur'\n        }]\n      },\n      healthRules: {\n        medicalHistory: [{\n          type: 'array',\n          required: true,\n          message: '请选择既往病史',\n          trigger: 'change'\n        }],\n        selfCare: [{\n          required: true,\n          message: '请选择自理能力',\n          trigger: 'change'\n        }]\n      },\n      resultRules: {\n        conclusion: [{\n          required: true,\n          message: '请选择评估结论',\n          trigger: 'change'\n        }],\n        doctor: [{\n          required: true,\n          message: '请输入评估医生姓名',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.fetchPatientInfo();\n  },\n  methods: {\n    async fetchPatientInfo() {\n      try {\n        // 这里调用获取患者信息的 API\n        const response = await this.$store.dispatch('fetchHealthAssessmentDetail', this.id);\n        this.patientInfo = response.data;\n        // 填充基本信息\n        this.basicInfo = {\n          name: this.patientInfo.name,\n          gender: this.patientInfo.gender,\n          age: this.patientInfo.age,\n          idCard: this.patientInfo.idCard || '',\n          phone: this.patientInfo.phone || '',\n          emergencyContact: this.patientInfo.emergencyContact || '',\n          emergencyPhone: this.patientInfo.emergencyPhone || ''\n        };\n      } catch (error) {\n        this.$message.error('获取患者信息失败');\n      }\n    },\n    async nextStep() {\n      if (this.currentStep === 0) {\n        try {\n          await this.$refs.basicForm.validate();\n          this.currentStep++;\n        } catch (error) {\n          return;\n        }\n      } else if (this.currentStep === 1) {\n        try {\n          await this.$refs.healthForm.validate();\n          this.currentStep++;\n        } catch (error) {\n          return;\n        }\n      }\n    },\n    prevStep() {\n      if (this.currentStep > 0) {\n        this.currentStep--;\n      }\n    },\n    async submitAssessment() {\n      try {\n        await this.$refs.resultForm.validate();\n        const assessmentData = {\n          patientId: this.id,\n          basicInfo: this.basicInfo,\n          healthInfo: this.healthInfo,\n          assessmentResult: this.assessmentResult,\n          status: this.assessmentResult.conclusion === 'unsuitable' ? 'rejected' : 'completed',\n          time: new Date().toISOString(),\n          operator: this.assessmentResult.doctor\n        };\n        await this.$store.dispatch('updateHealthAssessment', assessmentData);\n        this.$message.success('评估提交成功');\n        this.$router.push('/assessment');\n      } catch (error) {\n        this.$message.error('提交失败，请检查表单');\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","props","id","type","String","required","data","currentStep","patientInfo","basicInfo","gender","age","idCard","phone","emergencyContact","emergencyPhone","healthInfo","medicalHistory","hasAllergies","allergiesDetail","selfCare","remarks","assessmentResult","conclusion","suggestions","doctor","basicRules","message","trigger","pattern","healthRules","resultRules","created","fetchPatientInfo","methods","response","$store","dispatch","error","$message","nextStep","$refs","basicForm","validate","healthForm","prevStep","submitAssessment","resultForm","assessmentData","patientId","status","time","Date","toISOString","operator","success","$router","push"],"sources":["src/views/HealthAssessment.vue"],"sourcesContent":["<template>\r\n  <div class=\"health-assessment\">\r\n    <div class=\"page-header\">\r\n      <div class=\"title\">\r\n        <span class=\"main-title\">健康评估</span>\r\n        <el-tag type=\"info\" size=\"medium\">{{ patientInfo.name }}</el-tag>\r\n      </div>\r\n      <div class=\"steps\">\r\n        <el-steps :active=\"currentStep\" finish-status=\"success\" align-center>\r\n          <el-step title=\"基本信息\"></el-step>\r\n          <el-step title=\"健康状况\"></el-step>\r\n          <el-step title=\"评估结果\"></el-step>\r\n        </el-steps>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"form-container\">\r\n      <!-- 步骤一：基本信息 -->\r\n      <el-form v-if=\"currentStep === 0\" ref=\"basicForm\" :model=\"basicInfo\" :rules=\"basicRules\" label-width=\"120px\">\r\n        <el-form-item label=\"姓名\" prop=\"name\">\r\n          <el-input v-model=\"basicInfo.name\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"性别\" prop=\"gender\">\r\n          <el-input v-model=\"basicInfo.gender\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"年龄\" prop=\"age\">\r\n          <el-input v-model=\"basicInfo.age\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"身份证号\" prop=\"idCard\">\r\n          <el-input v-model=\"basicInfo.idCard\" placeholder=\"请输入身份证号\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"联系电话\" prop=\"phone\">\r\n          <el-input v-model=\"basicInfo.phone\" placeholder=\"请输入联系电话\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"紧急联系人\" prop=\"emergencyContact\">\r\n          <el-input v-model=\"basicInfo.emergencyContact\" placeholder=\"请输入紧急联系人\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"紧急联系电话\" prop=\"emergencyPhone\">\r\n          <el-input v-model=\"basicInfo.emergencyPhone\" placeholder=\"请输入紧急联系电话\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n\r\n      <!-- 步骤二：健康状况 -->\r\n      <el-form v-if=\"currentStep === 1\" ref=\"healthForm\" :model=\"healthInfo\" :rules=\"healthRules\" label-width=\"120px\">\r\n        <el-form-item label=\"既往病史\" prop=\"medicalHistory\">\r\n          <el-checkbox-group v-model=\"healthInfo.medicalHistory\">\r\n            <el-checkbox label=\"高血压\">高血压</el-checkbox>\r\n            <el-checkbox label=\"糖尿病\">糖尿病</el-checkbox>\r\n            <el-checkbox label=\"心脏病\">心脏病</el-checkbox>\r\n            <el-checkbox label=\"其他\">其他</el-checkbox>\r\n          </el-checkbox-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"过敏史\" prop=\"allergies\">\r\n          <el-radio-group v-model=\"healthInfo.hasAllergies\">\r\n            <el-radio :label=\"true\">有</el-radio>\r\n            <el-radio :label=\"false\">无</el-radio>\r\n          </el-radio-group>\r\n          <el-input\r\n            v-if=\"healthInfo.hasAllergies\"\r\n            v-model=\"healthInfo.allergiesDetail\"\r\n            type=\"textarea\"\r\n            placeholder=\"请详细描述过敏情况\"\r\n            :rows=\"3\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"自理能力\" prop=\"selfCare\">\r\n          <el-radio-group v-model=\"healthInfo.selfCare\">\r\n            <el-radio label=\"完全自理\">完全自理</el-radio>\r\n            <el-radio label=\"部分自理\">部分自理</el-radio>\r\n            <el-radio label=\"完全依赖\">完全依赖</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"备注\" prop=\"remarks\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            v-model=\"healthInfo.remarks\"\r\n            placeholder=\"请输入其他需要说明的情况\"\r\n            :rows=\"4\">\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n\r\n      <!-- 步骤三：评估结果 -->\r\n      <el-form v-if=\"currentStep === 2\" ref=\"resultForm\" :model=\"assessmentResult\" :rules=\"resultRules\" label-width=\"120px\">\r\n        <el-form-item label=\"评估结论\" prop=\"conclusion\">\r\n          <el-radio-group v-model=\"assessmentResult.conclusion\">\r\n            <el-radio label=\"suitable\">适合入院</el-radio>\r\n            <el-radio label=\"unsuitable\">不适合入院</el-radio>\r\n            <el-radio label=\"conditional\">有条件入院</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item \r\n          label=\"入院建议\" \r\n          prop=\"suggestions\"\r\n          :required=\"assessmentResult.conclusion === 'conditional'\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            v-model=\"assessmentResult.suggestions\"\r\n            placeholder=\"请输入入院建议\"\r\n            :rows=\"4\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"评估医生\" prop=\"doctor\">\r\n          <el-input v-model=\"assessmentResult.doctor\" placeholder=\"请输入评估医生姓名\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"form-actions\">\r\n      <el-button v-if=\"currentStep > 0\" @click=\"prevStep\">上一步</el-button>\r\n      <el-button \r\n        v-if=\"currentStep < 2\" \r\n        type=\"primary\" \r\n        @click=\"nextStep\">\r\n        下一步\r\n      </el-button>\r\n      <el-button \r\n        v-else \r\n        type=\"primary\" \r\n        @click=\"submitAssessment\">\r\n        提交评估\r\n      </el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'HealthAssessment',\r\n  props: {\r\n    id: {\r\n      type: String,\r\n      required: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      currentStep: 0,\r\n      patientInfo: {},\r\n      basicInfo: {\r\n        name: '',\r\n        gender: '',\r\n        age: '',\r\n        idCard: '',\r\n        phone: '',\r\n        emergencyContact: '',\r\n        emergencyPhone: ''\r\n      },\r\n      healthInfo: {\r\n        medicalHistory: [],\r\n        hasAllergies: false,\r\n        allergiesDetail: '',\r\n        selfCare: '',\r\n        remarks: ''\r\n      },\r\n      assessmentResult: {\r\n        conclusion: '',\r\n        suggestions: '',\r\n        doctor: ''\r\n      },\r\n      // 表单验证规则\r\n      basicRules: {\r\n        idCard: [\r\n          { required: true, message: '请输入身份证号', trigger: 'blur' },\r\n          { pattern: /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/, message: '请输入正确的身份证号', trigger: 'blur' }\r\n        ],\r\n        phone: [\r\n          { required: true, message: '请输入联系电话', trigger: 'blur' },\r\n          { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }\r\n        ],\r\n        emergencyContact: [\r\n          { required: true, message: '请输入紧急联系人', trigger: 'blur' }\r\n        ],\r\n        emergencyPhone: [\r\n          { required: true, message: '请输入紧急联系电话', trigger: 'blur' },\r\n          { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }\r\n        ]\r\n      },\r\n      healthRules: {\r\n        medicalHistory: [\r\n          { type: 'array', required: true, message: '请选择既往病史', trigger: 'change' }\r\n        ],\r\n        selfCare: [\r\n          { required: true, message: '请选择自理能力', trigger: 'change' }\r\n        ]\r\n      },\r\n      resultRules: {\r\n        conclusion: [\r\n          { required: true, message: '请选择评估结论', trigger: 'change' }\r\n        ],\r\n        doctor: [\r\n          { required: true, message: '请输入评估医生姓名', trigger: 'blur' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.fetchPatientInfo()\r\n  },\r\n  methods: {\r\n    async fetchPatientInfo() {\r\n      try {\r\n        // 这里调用获取患者信息的 API\r\n        const response = await this.$store.dispatch('fetchHealthAssessmentDetail', this.id)\r\n        this.patientInfo = response.data\r\n        // 填充基本信息\r\n        this.basicInfo = {\r\n          name: this.patientInfo.name,\r\n          gender: this.patientInfo.gender,\r\n          age: this.patientInfo.age,\r\n          idCard: this.patientInfo.idCard || '',\r\n          phone: this.patientInfo.phone || '',\r\n          emergencyContact: this.patientInfo.emergencyContact || '',\r\n          emergencyPhone: this.patientInfo.emergencyPhone || ''\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取患者信息失败')\r\n      }\r\n    },\r\n    async nextStep() {\r\n      if (this.currentStep === 0) {\r\n        try {\r\n          await this.$refs.basicForm.validate()\r\n          this.currentStep++\r\n        } catch (error) {\r\n          return\r\n        }\r\n      } else if (this.currentStep === 1) {\r\n        try {\r\n          await this.$refs.healthForm.validate()\r\n          this.currentStep++\r\n        } catch (error) {\r\n          return\r\n        }\r\n      }\r\n    },\r\n    prevStep() {\r\n      if (this.currentStep > 0) {\r\n        this.currentStep--\r\n      }\r\n    },\r\n    async submitAssessment() {\r\n      try {\r\n        await this.$refs.resultForm.validate()\r\n        \r\n        const assessmentData = {\r\n          patientId: this.id,\r\n          basicInfo: this.basicInfo,\r\n          healthInfo: this.healthInfo,\r\n          assessmentResult: this.assessmentResult,\r\n          status: this.assessmentResult.conclusion === 'unsuitable' ? 'rejected' : 'completed',\r\n          time: new Date().toISOString(),\r\n          operator: this.assessmentResult.doctor\r\n        }\r\n\r\n        await this.$store.dispatch('updateHealthAssessment', assessmentData)\r\n        this.$message.success('评估提交成功')\r\n        this.$router.push('/assessment')\r\n      } catch (error) {\r\n        this.$message.error('提交失败，请检查表单')\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.health-assessment {\r\n  background: #fff;\r\n  padding: 20px;\r\n  border-radius: 4px;\r\n  min-height: calc(100vh - 140px);\r\n\r\n  .page-header {\r\n    margin-bottom: 30px;\r\n\r\n    .title {\r\n      margin-bottom: 20px;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 12px;\r\n\r\n      .main-title {\r\n        font-size: 20px;\r\n        font-weight: 500;\r\n        color: #303133;\r\n      }\r\n    }\r\n\r\n    .steps {\r\n      margin: 20px 0 30px;\r\n    }\r\n  }\r\n\r\n  .form-container {\r\n    max-width: 800px;\r\n    margin: 0 auto;\r\n    padding: 20px;\r\n\r\n    .el-form-item {\r\n      margin-bottom: 22px;\r\n\r\n      /deep/ .el-form-item__label {\r\n        font-weight: 500;\r\n      }\r\n    }\r\n\r\n    .el-checkbox-group {\r\n      display: flex;\r\n      gap: 20px;\r\n    }\r\n\r\n    .el-radio-group {\r\n      display: flex;\r\n      gap: 20px;\r\n    }\r\n\r\n    .el-input.is-disabled .el-input__inner {\r\n      color: #606266;\r\n    }\r\n  }\r\n\r\n  .form-actions {\r\n    display: flex;\r\n    justify-content: center;\r\n    gap: 20px;\r\n    margin-top: 40px;\r\n    padding-bottom: 20px;\r\n\r\n    .el-button {\r\n      min-width: 120px;\r\n    }\r\n  }\r\n}\r\n</style> "],"mappings":";AA+HA;EACAA,IAAA;EACAC,KAAA;IACAC,EAAA;MACAC,IAAA,EAAAC,MAAA;MACAC,QAAA;IACA;EACA;EACAC,KAAA;IACA;MACAC,WAAA;MACAC,WAAA;MACAC,SAAA;QACAT,IAAA;QACAU,MAAA;QACAC,GAAA;QACAC,MAAA;QACAC,KAAA;QACAC,gBAAA;QACAC,cAAA;MACA;MACAC,UAAA;QACAC,cAAA;QACAC,YAAA;QACAC,eAAA;QACAC,QAAA;QACAC,OAAA;MACA;MACAC,gBAAA;QACAC,UAAA;QACAC,WAAA;QACAC,MAAA;MACA;MACA;MACAC,UAAA;QACAd,MAAA,GACA;UAAAP,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,OAAA;UAAAF,OAAA;UAAAC,OAAA;QAAA,EACA;QACAf,KAAA,GACA;UAAAR,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,OAAA;UAAAF,OAAA;UAAAC,OAAA;QAAA,EACA;QACAd,gBAAA,GACA;UAAAT,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,EACA;QACAb,cAAA,GACA;UAAAV,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,OAAA;UAAAF,OAAA;UAAAC,OAAA;QAAA;MAEA;MACAE,WAAA;QACAb,cAAA,GACA;UAAAd,IAAA;UAAAE,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,EACA;QACAR,QAAA,GACA;UAAAf,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA;MAEA;MACAG,WAAA;QACAR,UAAA,GACA;UAAAlB,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA,EACA;QACAH,MAAA,GACA;UAAApB,QAAA;UAAAsB,OAAA;UAAAC,OAAA;QAAA;MAEA;IACA;EACA;EACAI,QAAA;IACA,KAAAC,gBAAA;EACA;EACAC,OAAA;IACA,MAAAD,iBAAA;MACA;QACA;QACA,MAAAE,QAAA,cAAAC,MAAA,CAAAC,QAAA,qCAAAnC,EAAA;QACA,KAAAM,WAAA,GAAA2B,QAAA,CAAA7B,IAAA;QACA;QACA,KAAAG,SAAA;UACAT,IAAA,OAAAQ,WAAA,CAAAR,IAAA;UACAU,MAAA,OAAAF,WAAA,CAAAE,MAAA;UACAC,GAAA,OAAAH,WAAA,CAAAG,GAAA;UACAC,MAAA,OAAAJ,WAAA,CAAAI,MAAA;UACAC,KAAA,OAAAL,WAAA,CAAAK,KAAA;UACAC,gBAAA,OAAAN,WAAA,CAAAM,gBAAA;UACAC,cAAA,OAAAP,WAAA,CAAAO,cAAA;QACA;MACA,SAAAuB,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;IACA,MAAAE,SAAA;MACA,SAAAjC,WAAA;QACA;UACA,WAAAkC,KAAA,CAAAC,SAAA,CAAAC,QAAA;UACA,KAAApC,WAAA;QACA,SAAA+B,KAAA;UACA;QACA;MACA,gBAAA/B,WAAA;QACA;UACA,WAAAkC,KAAA,CAAAG,UAAA,CAAAD,QAAA;UACA,KAAApC,WAAA;QACA,SAAA+B,KAAA;UACA;QACA;MACA;IACA;IACAO,SAAA;MACA,SAAAtC,WAAA;QACA,KAAAA,WAAA;MACA;IACA;IACA,MAAAuC,iBAAA;MACA;QACA,WAAAL,KAAA,CAAAM,UAAA,CAAAJ,QAAA;QAEA,MAAAK,cAAA;UACAC,SAAA,OAAA/C,EAAA;UACAO,SAAA,OAAAA,SAAA;UACAO,UAAA,OAAAA,UAAA;UACAM,gBAAA,OAAAA,gBAAA;UACA4B,MAAA,OAAA5B,gBAAA,CAAAC,UAAA;UACA4B,IAAA,MAAAC,IAAA,GAAAC,WAAA;UACAC,QAAA,OAAAhC,gBAAA,CAAAG;QACA;QAEA,WAAAW,MAAA,CAAAC,QAAA,2BAAAW,cAAA;QACA,KAAAT,QAAA,CAAAgB,OAAA;QACA,KAAAC,OAAA,CAAAC,IAAA;MACA,SAAAnB,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}